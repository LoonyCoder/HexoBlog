<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="description" content="Life Is So Short , Just Coding.">
  <meta name="author" content="LoonyCoder">
  <meta name="keywords" content="隐约雷鸣，阴霾天空，但盼风雨来，能留你于此">
  <title>深入浅出JVM虚拟机——JVM调优 ~ 望月Plenilune</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"  >
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css"  >
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css"  >
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css"  >

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"  >

<link rel="stylesheet" href="/css/main.css"  >


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"  >


<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>望月Plenilune</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">分类</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">关于</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" false
         style="background: url('/images/post_banner.jpg')no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  星期三, 二月 27日 2019, 6:40 晚上
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    5k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      27 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <p><strong>参考文章:</strong> <a href="https://www.jianshu.com/p/aaee11115f37" target="_blank" rel="noopener">JVM调优指南</a></p>
<hr>
<h3 id="JVM参数的类型"><a href="#JVM参数的类型" class="headerlink" title="JVM参数的类型"></a>JVM参数的类型</h3><h4 id="标准参数：在各jdk版本中较稳定"><a href="#标准参数：在各jdk版本中较稳定" class="headerlink" title="标准参数：在各jdk版本中较稳定"></a>标准参数：在各jdk版本中较稳定</h4><code>
    -help<br>
    -server -client<br>
    -version -showversion<br>
    -cp -classpath<br>
</code>

<h4 id="X参数"><a href="#X参数" class="headerlink" title="X参数"></a>X参数</h4><h5 id="非标准化参数"><a href="#非标准化参数" class="headerlink" title="非标准化参数"></a>非标准化参数</h5><h5 id="Xint：完全解释执行"><a href="#Xint：完全解释执行" class="headerlink" title="-Xint：完全解释执行"></a>-Xint：完全解释执行</h5><p>调整为<code>完全解释执行</code>编译模式:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MacBook-Pro:dubbo-learn loonycoder$ java -Xint -version</span><br><span class="line">java version <span class="string">"1.8.0_161"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_161-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.161-b12, interpreted mode)</span><br></pre></td></tr></table></figure>

<h5 id="Xcomp：第一次使用就编译成本地代码"><a href="#Xcomp：第一次使用就编译成本地代码" class="headerlink" title="-Xcomp：第一次使用就编译成本地代码"></a>-Xcomp：第一次使用就编译成本地代码</h5><p>调整为<code>编译执行</code>编译模式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MacBook-Pro:dubbo-learn loonycoder$ java -Xcomp -version</span><br><span class="line">java version <span class="string">"1.8.0_161"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_161-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.161-b12, compiled mode)</span><br></pre></td></tr></table></figure>

<h5 id="Xmixed：混合模式，JVM自己来决定是否编译成本地代码"><a href="#Xmixed：混合模式，JVM自己来决定是否编译成本地代码" class="headerlink" title="-Xmixed：混合模式，JVM自己来决定是否编译成本地代码"></a>-Xmixed：混合模式，JVM自己来决定是否编译成本地代码</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MacBook-Pro:~ loonycoder$ java -version</span><br><span class="line">java version <span class="string">"1.8.0_161"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_161-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.161-b12, mixed mode)</span><br></pre></td></tr></table></figure>

<p>最后一行的<code>mixed mode</code>表明JVM默认使用的编译模式是<code>混合模式</code></p>
<h4 id="XX参数"><a href="#XX参数" class="headerlink" title="XX参数"></a>XX参数</h4><p>使用最多的一种参数类型</p>
<h5 id="Boolean类型"><a href="#Boolean类型" class="headerlink" title="Boolean类型"></a>Boolean类型</h5><p>格式：<code>-XX:[+/-] &lt;name&gt;</code>表示启用或者禁用name属性<br>比如：<br><code>-XX:+UseConcMarkSweepGC</code> 表示启用CMS垃圾回收器<br><code>-XX:+UseG1GC</code> 表示启用G1垃圾回收器</p>
<h5 id="非Boolean类型"><a href="#非Boolean类型" class="headerlink" title="非Boolean类型"></a>非Boolean类型</h5><p>格式：<code>-XX:&lt;name&gt; = &lt;value&gt;</code> 表示name属性的值为value<br>比如：<br><code>-XX:MaxGCPauseMillis=500</code> 表示GC最大停顿时间是500毫秒<br><code>-XX:GCTimeRatio=19</code> 表示吞吐量大小(通常是0-100之间的整数)假设 GCTimeRatio 的值为 n，那么系统将花费不超过 1/(1+n) 的时间用于垃圾收集。 </p>
<h5 id="Xmx-Xms"><a href="#Xmx-Xms" class="headerlink" title="-Xmx -Xms"></a>-Xmx -Xms</h5><p>虽然1以X开头，但是不是X类型参数，而是XX类型的参数</p>
<ul>
<li><p>-Xmx等价于-XX:MaxHeapSize 表示最大堆内存大小，可使用<code>jinfo -flag MaxHeapSize</code>进程id查看，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment"># ps -ef|grep java</span></span><br><span class="line">root      9723     1  0 4月24 ?       04:28:59 /usr/program/jdk1.8.0_72/jre/bin/java -Djava.util.logging.config.file=/opt/tomcat/apache-tomcat-8.0.50/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Dignore.endorsed.dirs= -classpath /opt/tomcat/apache-tomcat-8.0.50/bin/bootstrap.jar:/opt/tomcat/apache-tomcat-8.0.50/bin/tomcat-juli.jar -Dcatalina.base=/opt/tomcat/apache-tomcat-8.0.50 -Dcatalina.home=/opt/tomcat/apache-tomcat-8.0.50 -Djava.io.tmpdir=/opt/tomcat/apache-tomcat-8.0.50/temp org.apache.catalina.startup.Bootstrap start</span><br><span class="line">root     20037 19984  0 20:53 pts/2    00:00:00 grep --color=auto java</span><br><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment"># ./jinfo -flag MaxHeapSize 9723</span></span><br><span class="line">-XX:MaxHeapSize=482344960</span><br><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>-Xms等价于-XX:InitalHeapSize 表示堆内存初始大小</p>
</li>
<li><p>-Xss等价于-XX:InitalStackSize 表示线程栈的初始大小，可以使用<code>jinfo -flag ThreadStackSize</code>进程id查看，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment"># ps -ef</span></span><br><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment"># ps -ef|grep java</span></span><br><span class="line">root      9723     1  0 4月24 ?       04:28:59 /usr/program/jdk1.8.0_72/jre/bin/java -Djava.util.logging.config.file=/opt/tomcat/apache-tomcat-8.0.50/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Dignore.endorsed.dirs= -classpath /opt/tomcat/apache-tomcat-8.0.50/bin/bootstrap.jar:/opt/tomcat/apache-tomcat-8.0.50/bin/tomcat-juli.jar -Dcatalina.base=/opt/tomcat/apache-tomcat-8.0.50 -Dcatalina.home=/opt/tomcat/apache-tomcat-8.0.50 -Djava.io.tmpdir=/opt/tomcat/apache-tomcat-8.0.50/temp org.apache.catalina.startup.Bootstrap start</span><br><span class="line">root     20037 19984  0 20:53 pts/2    00:00:00 grep --color=auto java</span><br><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment"># ./jinfo -flag MaxHeapSize 9723</span></span><br><span class="line">-XX:MaxHeapSize=482344960</span><br><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment"># ./jinfo -flag ThreadStackSize 9723</span></span><br><span class="line">-XX:ThreadStackSize=1024</span><br><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<hr>
<h3 id="VM运行时参数查看"><a href="#VM运行时参数查看" class="headerlink" title="VM运行时参数查看"></a>VM运行时参数查看</h3><ul>
<li><code>-XX:+printFlagsInitial</code> 查看JVM运行时初始值</li>
<li><code>-XX:+printFlagsFinal</code> 查看JVM运行时最终值</li>
<li><code>-XX:+UnlockExperimentalVMOptions</code> 解锁实验参数</li>
<li><code>-XX:+UnlockDiagnosticVMOptions</code> 解锁诊断参数</li>
<li><code>-XX:+PrintCommandLineFlags</code> 打印命令行参数</li>
</ul>
<p>如查看JVM版本信息：<code>java -XX:+PrintFlagsFinal -version &gt; ~/version.txt</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">version.txt中部分参数：</span><br><span class="line">[Global flags]</span><br><span class="line">    uintx AdaptiveSizeDecrementScaleFactor          = 4                                   &#123;product&#125;</span><br><span class="line">    uintx AdaptiveSizeMajorGCDecayTimeScale         = 10                                  &#123;product&#125;</span><br><span class="line">    uintx AdaptiveSizePausePolicy                   = 0                                   &#123;product&#125;</span><br><span class="line">    uintx AdaptiveSizePolicyCollectionCostMargin    = 50                                  &#123;product&#125;</span><br><span class="line">    uintx AdaptiveSizePolicyInitializingSteps       = 20                                  &#123;product&#125;</span><br><span class="line">    uintx AdaptiveSizePolicyOutputInterval          = 0                                   &#123;product&#125;</span><br><span class="line">    uintx AdaptiveSizePolicyWeight                  = 10                                  &#123;product&#125;</span><br><span class="line">    uintx AdaptiveSizeThroughPutPolicy              = 0                                   &#123;product&#125;</span><br><span class="line">    uintx AdaptiveTimeWeight                        = 25                                  &#123;product&#125;</span><br><span class="line">     bool AdjustConcurrency                         = <span class="literal">false</span>                               &#123;product&#125;</span><br><span class="line">     bool AggressiveOpts                            = <span class="literal">false</span>                               &#123;product&#125;</span><br><span class="line">     bool C1ProfileVirtualCalls                     = <span class="literal">true</span>                                &#123;C1 product&#125;</span><br><span class="line">     bool C1UpdateMethodData                        = <span class="literal">true</span>                                &#123;C1 product&#125;</span><br><span class="line">     intx CICompilerCount                          := 2                                   &#123;product&#125;</span><br><span class="line">     bool CICompilerCountPerCPU                     = <span class="literal">true</span>                                &#123;product&#125;</span><br><span class="line">     bool CITime                                    = <span class="literal">false</span>                               &#123;product&#125;</span><br><span class="line">     bool CMSAbortSemantics                         = <span class="literal">false</span>                               &#123;product&#125;</span><br><span class="line">    uintx CMSAbortablePrecleanMinWorkPerIteration   = 100                                 &#123;product&#125;</span><br><span class="line">     intx CMSAbortablePrecleanWaitMillis            = 100                                 &#123;manageable&#125;</span><br><span class="line">    uintx CMSBitMapYieldQuantum                     = 10485760</span><br></pre></td></tr></table></figure>

<p>注：<code>=</code>表示默认值，<code>=:</code>表示修改后的值</p>
<h4 id="jps：查看Java进程"><a href="#jps：查看Java进程" class="headerlink" title="jps：查看Java进程"></a>jps：查看Java进程</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment"># ./jps</span></span><br><span class="line">20160 Jps</span><br><span class="line">9723 Bootstrap</span><br><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment"># ./jps -l</span></span><br><span class="line">20170 sun.tools.jps.Jps</span><br><span class="line">9723 org.apache.catalina.startup.Bootstrap</span><br><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>关于jps等命令的详解，可参考此文档<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/index.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/index.html</a></p>
<h4 id="jinfo：查看指定Java进程运行时参数"><a href="#jinfo：查看指定Java进程运行时参数" class="headerlink" title="jinfo：查看指定Java进程运行时参数"></a>jinfo：查看指定Java进程运行时参数</h4><p>如查看一个java进程id为9723的tomcat服务最大堆内存大小</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment"># ps -ef|grep java</span></span><br><span class="line">root      9723     1  0 4月24 ?       04:29:03 /usr/program/jdk1.8.0_72/jre/bin/java -Djava.util.logging.config.file=/opt/tomcat/apache-tomcat-8.0.50/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Dignore.endorsed.dirs= -classpath /opt/tomcat/apache-tomcat-8.0.50/bin/bootstrap.jar:/opt/tomcat/apache-tomcat-8.0.50/bin/tomcat-juli.jar -Dcatalina.base=/opt/tomcat/apache-tomcat-8.0.50 -Dcatalina.home=/opt/tomcat/apache-tomcat-8.0.50 -Djava.io.tmpdir=/opt/tomcat/apache-tomcat-8.0.50/temp org.apache.catalina.startup.Bootstrap start</span><br><span class="line">root     20187 20123  0 21:34 pts/2    00:00:00 grep --color=auto java</span><br><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment"># ./jinfo -flag MaxHeapSize 9723</span></span><br><span class="line">-XX:MaxHeapSize=482344960</span><br><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>查看一个进程的所有运行时参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment"># ./jinfo -flags 9732</span></span><br><span class="line">Attaching to process ID 9732, please <span class="built_in">wait</span>...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.72-b15</span><br><span class="line">Non-default VM flags: -XX:CICompilerCount=2 </span><br><span class="line">-XX:InitialHeapSize=31457280 -XX:MaxHeapSize=482344960 </span><br><span class="line">-XX:MaxNewSize=160759808 -XX:MinHeapDeltaBytes=196608 </span><br><span class="line">-XX:NewSize=10485760 -XX:OldSize=20971520 </span><br><span class="line">-XX:+UseCompressedClassPointers -XX:+UseCompressedOops</span><br><span class="line">Command line:  -Djava.util.logging.config.file=/opt/tomcat/apache-tomcat-8.0.50/conf/logging.properties </span><br><span class="line">-Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 </span><br><span class="line">-Djava.protocol.handler.pkgs=org.apache.catalina.webresources </span><br><span class="line">-Dignore.endorsed.dirs= -Dcatalina.base=/opt/tomcat/apache-tomcat-8.0.50 </span><br><span class="line">-Dcatalina.home=/opt/tomcat/apache-tomcat-8.0.50 </span><br><span class="line">-Djava.io.tmpdir=/opt/tomcat/apache-tomcat-8.0.50/temp</span><br><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><code>Non-default VM flags</code>表示手动赋值过的参数，其中有些是tomcat设置的<br><code>Command line</code>：与<code>Non-default VM flags</code></p>
<p>查看垃圾回收器信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MacBook-Pro:dubbo-learn loonycoder$ jinfo -flag UseConcMarkSweepGc 29159</span><br><span class="line">no such flag <span class="string">'UseConcMarkSweepGc'</span></span><br><span class="line">MacBook-Pro:dubbo-learn loonycoder$ jinfo -flag UseG1Gc 29159</span><br><span class="line">no such flag <span class="string">'UseG1Gc'</span></span><br><span class="line">MacBook-Pro:dubbo-learn loonycoder$ jinfo -flag UseParallelGc 29159</span><br><span class="line">no such flag <span class="string">'UseParallelGc'</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="jstat查看虚拟机统计信息"><a href="#jstat查看虚拟机统计信息" class="headerlink" title="jstat查看虚拟机统计信息"></a>jstat查看虚拟机统计信息</h3><h4 id="类装载"><a href="#类装载" class="headerlink" title="类装载"></a>类装载</h4><p>格式：<code>jstat -class 进程id 每隔多少毫秒 一共输出多少次</code><br>如：查看一个进程id为29159的java进程，每隔1s输出，一共输出10次</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MacBook-Pro:dubbo-learn loonycoder$ jstat -class 29159 1000 10</span><br><span class="line">Loaded  Bytes  Unloaded  Bytes     Time</span><br><span class="line">  3204  6088.2        0     0.0       2.14</span><br><span class="line">  3204  6088.2        0     0.0       2.14</span><br><span class="line">  3204  6088.2        0     0.0       2.14</span><br><span class="line">  3204  6088.2        0     0.0       2.14</span><br><span class="line">  3204  6088.2        0     0.0       2.14</span><br><span class="line">  3204  6088.2        0     0.0       2.14</span><br><span class="line">  3204  6088.2        0     0.0       2.14</span><br><span class="line">  3204  6088.2        0     0.0       2.14</span><br><span class="line">  3204  6088.2        0     0.0       2.14</span><br><span class="line">  3204  6088.2        0     0.0       2.14</span><br></pre></td></tr></table></figure>

<ul>
<li>Loaded：表示类加载的个数</li>
<li>Bytes：表示类加载的大小，单位为kb</li>
<li>UnLoaded：表示类卸载的个数</li>
<li>Bytes：表示类卸载的大小，单位为kb</li>
<li>Time：表示类加载和卸载的时间</li>
</ul>
<h4 id="垃圾收集"><a href="#垃圾收集" class="headerlink" title="垃圾收集"></a>垃圾收集</h4><p>要查看一个java进程的垃圾收集器信息，可使用<code>jstat -gc 进程id 每隔多少毫秒 一共输出多少次</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MacBook-Pro:dubbo-learn loonycoder$ jstat -gc 29159 1000 3</span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line">5120.0 5120.0 4308.8  0.0   33280.0  17845.6   87552.0      88.0    18944.0 18304.7 2304.0 2144.9      2    0.014   0      0.000    0.014</span><br><span class="line">5120.0 5120.0 4308.8  0.0   33280.0  17845.6   87552.0      88.0    18944.0 18304.7 2304.0 2144.9      2    0.014   0      0.000    0.014</span><br><span class="line">5120.0 5120.0 4308.8  0.0   33280.0  17845.6   87552.0      88.0    18944.0 18304.7 2304.0 2144.9      2    0.014   0      0.000    0.014</span><br></pre></td></tr></table></figure>

<p><code>S0C</code>: Current survivor space 0 capacity (kB).<code>表示survivor 0区的总大小</code><br><code>S1C</code>: Current survivor space 1 capacity (kB).<code>表示survivor 1区的总大小</code><br><code>S0U</code>: Survivor space 0 utilization (kB).<code>表示survivor 0区使用了的大小</code><br><code>S1U</code>: Survivor space 1 utilization (kB).<code>表示survivor 1区使用了的大小</code><br><code>EC</code>: Current eden space capacity (kB).<code>表示eden区总大小</code><br><code>EU</code>: Eden space utilization (kB).<code>表示eden区使用了的大小</code><br><code>OC</code>: Current old space capacity (kB).<code>表示old区总大小</code><br><code>OU</code>: Old space utilization (kB).<code>表示old区使用了的大小</code><br><code>MC</code>: Metaspace capacity (kB).<code>表示Metaspace区总大小</code><br><code>MU</code>: Metacspace utilization (kB).<code>表示Metaspace区使用了的大小</code><br><code>CCSC</code>: Compressed class space capacity (kB).<code>表示压缩类空间总量</code><br><code>CCSU</code>: Compressed class space used (kB).<code>表示压缩类空间使用量</code><br><code>YGC</code>: Number of young generation garbage collection events.<code>表示Young GC的次数</code><br><code>YGCT</code>: Young generation garbage collection time.<code>表示Young GC的时间</code><br><code>FGC</code>: Number of full GC events.<code>表示full GC的次数</code><br><code>FGCT</code>: Full garbage collection time.<code>表示full GC的时间</code><br><code>GCT</code>: Total garbage collection time.<code>表示总的 GC的时间</code></p>
<h4 id="JIT编译"><a href="#JIT编译" class="headerlink" title="JIT编译"></a>JIT编译</h4><h5 id="compiler参数"><a href="#compiler参数" class="headerlink" title="-compiler参数"></a>-compiler参数</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MacBook-Pro:dubbo-learn loonycoder$ jstat -compiler 29159 1000 5</span><br><span class="line">Compiled Failed Invalid   Time   FailedType FailedMethod</span><br><span class="line">    1284      0       0     3.50          0</span><br><span class="line">    1284      0       0     3.50          0</span><br><span class="line">    1284      0       0     3.50          0</span><br><span class="line">    1284      0       0     3.50          0</span><br><span class="line">    1284      0       0     3.50          0</span><br></pre></td></tr></table></figure>

<ul>
<li>Compiled：表示编译成功的方法数量</li>
<li>Failed：表示编译失败的方法数量</li>
<li>Invalid：表示编译无效的方法数量</li>
<li>Time：编译所花费的时间</li>
<li>FailedType：编译失败类型</li>
<li>FailedMethod：编译失败方法</li>
</ul>
<h5 id="printcompilation参数"><a href="#printcompilation参数" class="headerlink" title="-printcompilation参数"></a>-printcompilation参数</h5><hr>
<h3 id="jmap-MAT实战内存溢出"><a href="#jmap-MAT实战内存溢出" class="headerlink" title="jmap+MAT实战内存溢出"></a>jmap+MAT实战内存溢出</h3><p>模拟内存溢出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class MemoryController &#123;</span><br><span class="line">    </span><br><span class="line">    private List&lt;User&gt;  userList = new ArrayList&lt;User&gt;();</span><br><span class="line">    private List&lt;Class&lt;?&gt;&gt;  classList = new ArrayList&lt;Class&lt;?&gt;&gt;();</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * -Xmx32M -Xms32M</span><br><span class="line">     * */</span><br><span class="line">    @GetMapping(<span class="string">"/heap"</span>)</span><br><span class="line">    public String <span class="function"><span class="title">heap</span></span>() &#123;</span><br><span class="line">        int i=0;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            userList.add(new User(i++, UUID.randomUUID().toString()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * -XX:MetaspaceSize=32M -XX:MaxMetaspaceSize=32M</span><br><span class="line">     * */</span><br><span class="line">    @GetMapping(<span class="string">"/nonheap"</span>)</span><br><span class="line">    public String <span class="function"><span class="title">nonheap</span></span>() &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            classList.addAll(Metaspace.createClasses());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">package com.imooc.monitor_tuning.chapter2;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import org.objectweb.asm.ClassWriter;</span><br><span class="line">import org.objectweb.asm.MethodVisitor;</span><br><span class="line">import org.objectweb.asm.Opcodes;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * https://blog.csdn.net/bolg_hero/article/details/78189621</span><br><span class="line"> * 继承ClassLoader是为了方便调用defineClass方法，因为该方法的定义为protected</span><br><span class="line"> * */</span><br><span class="line">public class Metaspace extends ClassLoader &#123;</span><br><span class="line">    </span><br><span class="line">    public static List&lt;Class&lt;?&gt;&gt; <span class="function"><span class="title">createClasses</span></span>() &#123;</span><br><span class="line">        // 类持有</span><br><span class="line">        List&lt;Class&lt;?&gt;&gt; classes = new ArrayList&lt;Class&lt;?&gt;&gt;();</span><br><span class="line">        // 循环1000w次生成1000w个不同的类。</span><br><span class="line">        <span class="keyword">for</span> (int i = 0; i &lt; 10000000; ++i) &#123;</span><br><span class="line">            ClassWriter cw = new ClassWriter(0);</span><br><span class="line">            // 定义一个类名称为Class&#123;i&#125;，它的访问域为public，父类为java.lang.Object，不实现任何接口</span><br><span class="line">            cw.visit(Opcodes.V1_1, Opcodes.ACC_PUBLIC, <span class="string">"Class"</span> + i, null,</span><br><span class="line">                    <span class="string">"java/lang/Object"</span>, null);</span><br><span class="line">            // 定义构造函数&lt;init&gt;方法</span><br><span class="line">            MethodVisitor mw = cw.visitMethod(Opcodes.ACC_PUBLIC, <span class="string">"&lt;init&gt;"</span>,</span><br><span class="line">                    <span class="string">"()V"</span>, null, null);</span><br><span class="line">            // 第一个指令为加载this</span><br><span class="line">            mw.visitVarInsn(Opcodes.ALOAD, 0);</span><br><span class="line">            // 第二个指令为调用父类Object的构造函数</span><br><span class="line">            mw.visitMethodInsn(Opcodes.INVOKESPECIAL, <span class="string">"java/lang/Object"</span>,</span><br><span class="line">                    <span class="string">"&lt;init&gt;"</span>, <span class="string">"()V"</span>);</span><br><span class="line">            // 第三条指令为<span class="built_in">return</span></span><br><span class="line">            mw.visitInsn(Opcodes.RETURN);</span><br><span class="line">            mw.visitMaxs(1, 1);</span><br><span class="line">            mw.visitEnd();</span><br><span class="line">            Metaspace <span class="built_in">test</span> = new Metaspace();</span><br><span class="line">            byte[] code = cw.toByteArray();</span><br><span class="line">            // 定义类</span><br><span class="line">            Class&lt;?&gt; exampleClass = test.defineClass(<span class="string">"Class"</span> + i, code, 0, code.length);</span><br><span class="line">            classes.add(exampleClass);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> classes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.imooc.monitor_tuning.chapter2;</span><br><span class="line"></span><br><span class="line">public class User &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">    public User(int id, String name) &#123;</span><br><span class="line">        super();</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    public int <span class="function"><span class="title">getId</span></span>() &#123;</span><br><span class="line">        <span class="built_in">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    public String <span class="function"><span class="title">getName</span></span>() &#123;</span><br><span class="line">        <span class="built_in">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置启动参数：</p>
<p><img src="images/jvm/jvm16.png" srcset="/img/loading.gif" alt="jvm"></p>
<p>启动application，发现出现内存溢出</p>
<h4 id="如何导出内存溢出映像文件"><a href="#如何导出内存溢出映像文件" class="headerlink" title="如何导出内存溢出映像文件"></a>如何导出内存溢出映像文件</h4><h5 id="内存溢出自动导出"><a href="#内存溢出自动导出" class="headerlink" title="内存溢出自动导出"></a>内存溢出自动导出</h5><code>
-XX:+HeapDumpOnOutOfMemoryError<br>
-XX:HeapDumpPath=./<br>
</code>

<p><img src="images/jvm/jvm17.png" srcset="/img/loading.gif" alt="jvm"></p>
<h5 id="使用jmap命令手动导出"><a href="#使用jmap命令手动导出" class="headerlink" title="使用jmap命令手动导出"></a>使用jmap命令手动导出</h5><p>格式：<code>jmap -dump:format=b,file=路径/heap.hprof 进程id</code><br>其他命令：<code>jmap -heap 进程id</code> 查看堆信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@izwz93osmk5vi5qwqyscxaz bin]<span class="comment"># ./jmap -heap 9723</span></span><br><span class="line">Attaching to process ID 9723, please <span class="built_in">wait</span>...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.72-b15</span><br><span class="line"></span><br><span class="line">using thread-local object allocation.</span><br><span class="line">Mark Sweep Compact GC</span><br><span class="line"></span><br><span class="line">Heap Configuration:</span><br><span class="line">   MinHeapFreeRatio         = 40</span><br><span class="line">   MaxHeapFreeRatio         = 70</span><br><span class="line">   MaxHeapSize              = 482344960 (460.0MB)</span><br><span class="line">   NewSize                  = 10485760 (10.0MB)</span><br><span class="line">   MaxNewSize               = 160759808 (153.3125MB)</span><br><span class="line">   OldSize                  = 20971520 (20.0MB)</span><br><span class="line">   NewRatio                 = 2</span><br><span class="line">   SurvivorRatio            = 8</span><br><span class="line">   MetaspaceSize            = 21807104 (20.796875MB)</span><br><span class="line">   CompressedClassSpaceSize = 1073741824 (1024.0MB)</span><br><span class="line">   MaxMetaspaceSize         = 17592186044415 MB</span><br><span class="line">   G1HeapRegionSize         = 0 (0.0MB)</span><br><span class="line"></span><br><span class="line">Heap Usage:</span><br><span class="line">New Generation (Eden + 1 Survivor Space):</span><br><span class="line">   capacity = 32178176 (30.6875MB)</span><br><span class="line">   used     = 16081160 (15.336189270019531MB)</span><br><span class="line">   free     = 16097016 (15.351310729980469MB)</span><br><span class="line">   49.97536218336303% used</span><br><span class="line">Eden Space:</span><br><span class="line">   capacity = 28639232 (27.3125MB)</span><br><span class="line">   used     = 16054760 (15.311012268066406MB)</span><br><span class="line">   free     = 12584472 (12.001487731933594MB)</span><br><span class="line">   56.058626153103546% used</span><br><span class="line">From Space:</span><br><span class="line">   capacity = 3538944 (3.375MB)</span><br><span class="line">   used     = 26400 (0.025177001953125MB)</span><br><span class="line">   free     = 3512544 (3.349822998046875MB)</span><br><span class="line">   0.7459852430555556% used</span><br><span class="line">To Space:</span><br><span class="line">   capacity = 3538944 (3.375MB)</span><br><span class="line">   used     = 0 (0.0MB)</span><br><span class="line">   free     = 3538944 (3.375MB)</span><br><span class="line">   0.0% used</span><br><span class="line">tenured generation:</span><br><span class="line">   capacity = 71221248 (67.921875MB)</span><br><span class="line">   used     = 57115304 (54.469398498535156MB)</span><br><span class="line">   free     = 14105944 (13.452476501464844MB)</span><br><span class="line">   80.19419148622613% used</span><br><span class="line"></span><br><span class="line">27532 interned Strings occupying 3194040 bytes.</span><br></pre></td></tr></table></figure>

<h5 id="使用MAT分析映像文件"><a href="#使用MAT分析映像文件" class="headerlink" title="使用MAT分析映像文件"></a>使用MAT分析映像文件</h5><p><img src="images/jvm/jvm18.png" srcset="/img/loading.gif" alt="jvm"></p>
<ul>
<li>Class Name：类名</li>
<li>Objects：对象数量</li>
<li>Shallow Heap：</li>
<li>Retained Heap：占用的内存大小</li>
</ul>
<p>右键查看com.imooc.monitor_tuning.chapter2.User的强引用</p>
<p><img src="images/jvm/jvm19.png" srcset="/img/loading.gif" alt="jvm"><br><img src="images/jvm/jvm20.png" srcset="/img/loading.gif" alt="jvm"></p>
<p>也可以查看对象树：</p>
<p><img src="images/jvm/jvm21.png" srcset="/img/loading.gif" alt="jvm"></p>
<hr>
<h3 id="jstack实战死循环与死锁"><a href="#jstack实战死循环与死锁" class="headerlink" title="jstack实战死循环与死锁"></a>jstack实战死循环与死锁</h3><p>格式：<code>jstack 进程id</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line">2018-09-05 07:59:21</span><br><span class="line">Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.72-b15 mixed mode):</span><br><span class="line"></span><br><span class="line"><span class="string">"Attach Listener"</span> <span class="comment">#16 daemon prio=9 os_prio=0 tid=0x00007f3d9c001000 nid=0x521f waiting on condition [0x0000000000000000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line"><span class="string">"localhost-startStop-1"</span> <span class="comment">#15 daemon prio=5 os_prio=0 tid=0x00007f3dac002800 nid=0x5208 runnable [0x00007f3da15d1000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">    at java.io.FileInputStream.readBytes(Native Method)</span><br><span class="line">    at java.io.FileInputStream.read(FileInputStream.java:255)</span><br><span class="line">    at sun.security.provider.SeedGenerator<span class="variable">$URLSeedGenerator</span>.getSeedBytes(SeedGenerator.java:539)</span><br><span class="line">    at sun.security.provider.SeedGenerator.generateSeed(SeedGenerator.java:144)</span><br><span class="line">    at sun.security.provider.SecureRandom<span class="variable">$SeederHolder</span>.&lt;clinit&gt;(SecureRandom.java:203)</span><br><span class="line">    at sun.security.provider.SecureRandom.engineNextBytes(SecureRandom.java:221)</span><br><span class="line">    - locked &lt;0x00000000e3e90be0&gt; (a sun.security.provider.SecureRandom)</span><br><span class="line">    at java.security.SecureRandom.nextBytes(SecureRandom.java:468)</span><br><span class="line">    - locked &lt;0x00000000e3e910c0&gt; (a java.security.SecureRandom)</span><br><span class="line">    at java.security.SecureRandom.next(SecureRandom.java:491)</span><br><span class="line">    at java.util.Random.nextInt(Random.java:329)</span><br><span class="line">    at org.apache.catalina.util.SessionIdGeneratorBase.createSecureRandom(SessionIdGeneratorBase.java:240)</span><br><span class="line">    at org.apache.catalina.util.SessionIdGeneratorBase.getRandomBytes(SessionIdGeneratorBase.java:174)</span><br><span class="line">    at org.apache.catalina.util.StandardSessionIdGenerator.generateSessionId(StandardSessionIdGenerator.java:34)</span><br><span class="line">    at org.apache.catalina.util.SessionIdGeneratorBase.generateSessionId(SessionIdGeneratorBase.java:167)</span><br><span class="line">    at org.apache.catalina.util.SessionIdGeneratorBase.startInternal(SessionIdGeneratorBase.java:260)</span><br><span class="line">    at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145)</span><br><span class="line">    - locked &lt;0x00000000e3e90730&gt; (a org.apache.catalina.util.StandardSessionIdGenerator)</span><br><span class="line">    at org.apache.catalina.session.ManagerBase.startInternal(ManagerBase.java:717)</span><br><span class="line">    at org.apache.catalina.session.StandardManager.startInternal(StandardManager.java:352)</span><br><span class="line">    - locked &lt;0x00000000e42eefb0&gt; (a org.apache.catalina.session.StandardManager)</span><br><span class="line">    at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145)</span><br><span class="line">    - locked &lt;0x00000000e42eefb0&gt; (a org.apache.catalina.session.StandardManager)</span><br><span class="line">    at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5339)</span><br><span class="line">    - locked &lt;0x00000000ed3c6ca0&gt; (a org.apache.catalina.core.StandardContext)</span><br><span class="line">    at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145)</span><br><span class="line">    - locked &lt;0x00000000ed3c6ca0&gt; (a org.apache.catalina.core.StandardContext)</span><br><span class="line">    at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:753)</span><br><span class="line">    at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:729)</span><br><span class="line">    at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:717)</span><br><span class="line">    at org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:974)</span><br><span class="line">    at org.apache.catalina.startup.HostConfig<span class="variable">$DeployWar</span>.run(HostConfig.java:1850)</span><br><span class="line">    at java.util.concurrent.Executors<span class="variable">$RunnableAdapter</span>.call(Executors.java:511)</span><br><span class="line">    at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.java:617)</span><br><span class="line">    at java.lang.Thread.run(Thread.java:745)</span><br><span class="line"></span><br><span class="line"><span class="string">"Catalina-startStop-1"</span> <span class="comment">#14 daemon prio=5 os_prio=0 tid=0x00007f3dc4437000 nid=0x5207 waiting on condition [0x00007f3da16d2000]</span></span><br><span class="line">   java.lang.Thread.State: WAITING (parking)</span><br><span class="line">    at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">    - parking to <span class="built_in">wait</span> <span class="keyword">for</span>  &lt;0x00000000ed3c6fc0&gt; (a java.util.concurrent.FutureTask)</span><br><span class="line">    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)</span><br><span class="line">    at java.util.concurrent.FutureTask.awaitDone(FutureTask.java:429)</span><br><span class="line">    at java.util.concurrent.FutureTask.get(FutureTask.java:191)</span><br><span class="line">    at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:766)</span><br><span class="line">    at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:436)</span><br><span class="line">    at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1580)</span><br><span class="line">    at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:322)</span><br><span class="line">    at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:95)</span><br><span class="line">    at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90)</span><br><span class="line">    at org.apache.catalina.util.LifecycleBase.setStateInternal(LifecycleBase.java:388)</span><br><span class="line">    - locked &lt;0x00000000ed03ec38&gt; (a org.apache.catalina.core.StandardHost)</span><br><span class="line">    at org.apache.catalina.util.LifecycleBase.setState(LifecycleBase.java:333)</span><br><span class="line">    - locked &lt;0x00000000ed03ec38&gt; (a org.apache.catalina.core.StandardHost)</span><br><span class="line">    at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:960)</span><br><span class="line">    - locked &lt;0x00000000ed03ec38&gt; (a org.apache.catalina.core.StandardHost)</span><br><span class="line">    at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:871)</span><br><span class="line">    - locked &lt;0x00000000ed03ec38&gt; (a org.apache.catalina.core.StandardHost)</span><br><span class="line">    at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145)</span><br><span class="line">    - locked &lt;0x00000000ed03ec38&gt; (a org.apache.catalina.core.StandardHost)</span><br><span class="line">    at org.apache.catalina.core.ContainerBase<span class="variable">$StartChild</span>.call(ContainerBase.java:1408)</span><br><span class="line">    at org.apache.catalina.core.ContainerBase<span class="variable">$StartChild</span>.call(ContainerBase.java:1398)</span><br><span class="line">    at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.java:617)</span><br><span class="line">    at java.lang.Thread.run(Thread.java:745)</span><br><span class="line"></span><br><span class="line"><span class="string">"NioBlockingSelector.BlockPoller-2"</span> <span class="comment">#13 daemon prio=5 os_prio=0 tid=0x00007f3dc4429800 nid=0x5206 runnable [0x00007f3da17d4000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">    at sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)</span><br><span class="line">    at sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:269)</span><br><span class="line">    at sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:93)</span><br><span class="line">    at sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:86)</span><br><span class="line">    - locked &lt;0x00000000ed3c75a8&gt; (a sun.nio.ch.Util<span class="variable">$2</span>)</span><br><span class="line">    - locked &lt;0x00000000ed3c75b8&gt; (a java.util.Collections<span class="variable">$UnmodifiableSet</span>)</span><br><span class="line">    - locked &lt;0x00000000ed3c7560&gt; (a sun.nio.ch.EPollSelectorImpl)</span><br><span class="line">    at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:97)</span><br><span class="line">    at org.apache.tomcat.util.net.NioBlockingSelector<span class="variable">$BlockPoller</span>.run(NioBlockingSelector.java:301)</span><br><span class="line"></span><br><span class="line"><span class="string">"NioBlockingSelector.BlockPoller-1"</span> <span class="comment">#12 daemon prio=5 os_prio=0 tid=0x00007f3dc440e800 nid=0x5205 runnable [0x00007f3da18d5000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">    at sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)</span><br><span class="line">    at sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:269)</span><br><span class="line">    at sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:93)</span><br><span class="line">    at sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:86)</span><br><span class="line">    - locked &lt;0x00000000ed3c77e0&gt; (a sun.nio.ch.Util<span class="variable">$2</span>)</span><br><span class="line">    - locked &lt;0x00000000ed3c77f0&gt; (a java.util.Collections<span class="variable">$UnmodifiableSet</span>)</span><br><span class="line">    - locked &lt;0x00000000ed3c7798&gt; (a sun.nio.ch.EPollSelectorImpl)</span><br><span class="line">    at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:97)</span><br><span class="line">    at org.apache.tomcat.util.net.NioBlockingSelector<span class="variable">$BlockPoller</span>.run(NioBlockingSelector.java:301)</span><br><span class="line"></span><br><span class="line"><span class="string">"GC Daemon"</span> <span class="comment">#11 daemon prio=2 os_prio=0 tid=0x00007f3dc4356800 nid=0x5204 in Object.wait() [0x00007f3dc81a0000]</span></span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (on object monitor)</span><br><span class="line">    at java.lang.Object.wait(Native Method)</span><br><span class="line">    - waiting on &lt;0x00000000ed0d57f0&gt; (a sun.misc.GC<span class="variable">$LatencyLock</span>)</span><br><span class="line">    at sun.misc.GC<span class="variable">$Daemon</span>.run(GC.java:117)</span><br><span class="line">    - locked &lt;0x00000000ed0d57f0&gt; (a sun.misc.GC<span class="variable">$LatencyLock</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">"AsyncFileHandlerWriter-789451787"</span> <span class="comment">#10 daemon prio=5 os_prio=0 tid=0x00007f3dc4105000 nid=0x5203 waiting on condition [0x00007f3dc8338000]</span></span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (parking)</span><br><span class="line">    at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">    - parking to <span class="built_in">wait</span> <span class="keyword">for</span>  &lt;0x00000000ecec1210&gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer<span class="variable">$ConditionObject</span>)</span><br><span class="line">    at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)</span><br><span class="line">    at java.util.concurrent.locks.AbstractQueuedSynchronizer<span class="variable">$ConditionObject</span>.awaitNanos(AbstractQueuedSynchronizer.java:2078)</span><br><span class="line">    at java.util.concurrent.LinkedBlockingDeque.pollFirst(LinkedBlockingDeque.java:522)</span><br><span class="line">    at java.util.concurrent.LinkedBlockingDeque.poll(LinkedBlockingDeque.java:684)</span><br><span class="line">    at org.apache.juli.AsyncFileHandler<span class="variable">$LoggerThread</span>.run(AsyncFileHandler.java:153)</span><br><span class="line"></span><br><span class="line"><span class="string">"Service Thread"</span> <span class="comment">#7 daemon prio=9 os_prio=0 tid=0x00007f3dc40b3800 nid=0x5201 runnable [0x0000000000000000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line"><span class="string">"C1 CompilerThread1"</span> <span class="comment">#6 daemon prio=9 os_prio=0 tid=0x00007f3dc40b0800 nid=0x5200 waiting on condition [0x0000000000000000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line"><span class="string">"C2 CompilerThread0"</span> <span class="comment">#5 daemon prio=9 os_prio=0 tid=0x00007f3dc40ae800 nid=0x51ff waiting on condition [0x0000000000000000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line"><span class="string">"Signal Dispatcher"</span> <span class="comment">#4 daemon prio=9 os_prio=0 tid=0x00007f3dc40ad000 nid=0x51fe runnable [0x0000000000000000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line"><span class="string">"Finalizer"</span> <span class="comment">#3 daemon prio=8 os_prio=0 tid=0x00007f3dc407a000 nid=0x51fd in Object.wait() [0x00007f3dc893e000]</span></span><br><span class="line">   java.lang.Thread.State: WAITING (on object monitor)</span><br><span class="line">    at java.lang.Object.wait(Native Method)</span><br><span class="line">    - waiting on &lt;0x00000000ecec2320&gt; (a java.lang.ref.ReferenceQueue<span class="variable">$Lock</span>)</span><br><span class="line">    at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)</span><br><span class="line">    - locked &lt;0x00000000ecec2320&gt; (a java.lang.ref.ReferenceQueue<span class="variable">$Lock</span>)</span><br><span class="line">    at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)</span><br><span class="line">    at java.lang.ref.Finalizer<span class="variable">$FinalizerThread</span>.run(Finalizer.java:209)</span><br><span class="line"></span><br><span class="line"><span class="string">"Reference Handler"</span> <span class="comment">#2 daemon prio=10 os_prio=0 tid=0x00007f3dc4075000 nid=0x51fc in Object.wait() [0x00007f3dc8a3f000]</span></span><br><span class="line">   java.lang.Thread.State: WAITING (on object monitor)</span><br><span class="line">    at java.lang.Object.wait(Native Method)</span><br><span class="line">    - waiting on &lt;0x00000000ecec24d8&gt; (a java.lang.ref.Reference<span class="variable">$Lock</span>)</span><br><span class="line">    at java.lang.Object.wait(Object.java:502)</span><br><span class="line">    at java.lang.ref.Reference.tryHandlePending(Reference.java:191)</span><br><span class="line">    - locked &lt;0x00000000ecec24d8&gt; (a java.lang.ref.Reference<span class="variable">$Lock</span>)</span><br><span class="line">    at java.lang.ref.Reference<span class="variable">$ReferenceHandler</span>.run(Reference.java:153)</span><br><span class="line"></span><br><span class="line"><span class="string">"main"</span> <span class="comment">#1 prio=5 os_prio=0 tid=0x00007f3dc4009000 nid=0x51fa waiting on condition [0x00007f3dcc417000]</span></span><br><span class="line">   java.lang.Thread.State: WAITING (parking)</span><br><span class="line">    at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">    - parking to <span class="built_in">wait</span> <span class="keyword">for</span>  &lt;0x00000000ed3c7340&gt; (a java.util.concurrent.FutureTask)</span><br><span class="line">    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)</span><br><span class="line">    at java.util.concurrent.FutureTask.awaitDone(FutureTask.java:429)</span><br><span class="line">    at java.util.concurrent.FutureTask.get(FutureTask.java:191)</span><br><span class="line">    at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:943)</span><br><span class="line">    - locked &lt;0x00000000ecfb7038&gt; (a org.apache.catalina.core.StandardEngine)</span><br><span class="line">    at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:262)</span><br><span class="line">    - locked &lt;0x00000000ecfb7038&gt; (a org.apache.catalina.core.StandardEngine)</span><br><span class="line">    at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145)</span><br><span class="line">    - locked &lt;0x00000000ecfb7038&gt; (a org.apache.catalina.core.StandardEngine)</span><br><span class="line">    at org.apache.catalina.core.StandardService.startInternal(StandardService.java:441)</span><br><span class="line">    - locked &lt;0x00000000ecfb7038&gt; (a org.apache.catalina.core.StandardEngine)</span><br><span class="line">    at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145)</span><br><span class="line">    - locked &lt;0x00000000ecfa2330&gt; (a org.apache.catalina.core.StandardService)</span><br><span class="line">    at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:789)</span><br><span class="line">    - locked &lt;0x00000000ecf4e258&gt; (a java.lang.Object)</span><br><span class="line">    at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145)</span><br><span class="line">    - locked &lt;0x00000000ecf1c578&gt; (a org.apache.catalina.core.StandardServer)</span><br><span class="line">    at org.apache.catalina.startup.Catalina.start(Catalina.java:641)</span><br><span class="line">    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">    at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">    at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:349)</span><br><span class="line">    at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:483)</span><br><span class="line"></span><br><span class="line"><span class="string">"VM Thread"</span> os_prio=0 tid=0x00007f3dc406d800 nid=0x51fb runnable</span><br><span class="line"></span><br><span class="line"><span class="string">"VM Periodic Task Thread"</span> os_prio=0 tid=0x00007f3dc40b7000 nid=0x5202 waiting on condition</span><br><span class="line"></span><br><span class="line">JNI global references: 59</span><br></pre></td></tr></table></figure>

<ul>
<li>localhost-startStop-1：线程名</li>
<li>daemon：后台线程</li>
<li>prio：优先级</li>
<li>os_prio：系统优先级</li>
<li>tid：线程id</li>
<li>nid：操作系统id</li>
<li>java.lang.Thread.State：线程状态；NEW-线程尚未启动， RUNNABLE- 线程运行中，BLOCKED-等待一个锁， WAITINH-等待另一个线程， TIMED_WAITING-限时等待另一个线程， TERMINATED-已退出</li>
</ul>
<h4 id="实战死循环"><a href="#实战死循环" class="headerlink" title="实战死循环"></a>实战死循环</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">public class CpuController &#123;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 死循环</span><br><span class="line">     * */</span><br><span class="line">    @RequestMapping(<span class="string">"/loop"</span>)</span><br><span class="line">    public List&lt;Long&gt; <span class="function"><span class="title">loop</span></span>()&#123;</span><br><span class="line">        String data = <span class="string">"&#123;\"data\":[&#123;\"partnerid\":]"</span>;</span><br><span class="line">        <span class="built_in">return</span> getPartneridsFromJson(data);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private Object lock1 = new Object();</span><br><span class="line">    private Object lock2 = new Object();</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 死锁</span><br><span class="line">     * */</span><br><span class="line">    @RequestMapping(<span class="string">"/deadlock"</span>)</span><br><span class="line">    public String <span class="function"><span class="title">deadlock</span></span>()&#123;</span><br><span class="line">        new Thread(()-&gt;&#123;</span><br><span class="line">            synchronized(lock1) &#123;</span><br><span class="line">                try &#123;Thread.sleep(1000);&#125;catch(Exception e) &#123;&#125;</span><br><span class="line">                synchronized(lock2) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"Thread1 over"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;) .start();</span><br><span class="line">        new Thread(()-&gt;&#123;</span><br><span class="line">            synchronized(lock2) &#123;</span><br><span class="line">                try &#123;Thread.sleep(1000);&#125;catch(Exception e) &#123;&#125;</span><br><span class="line">                synchronized(lock1) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"Thread2 over"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;) .start();</span><br><span class="line">        <span class="built_in">return</span> <span class="string">"deadlock"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    public static List&lt;Long&gt; getPartneridsFromJson(String data)&#123;  </span><br><span class="line">        //&#123;\"data\":[&#123;\"partnerid\":982,\"count\":\"10000\",\"cityid\":\"11\"&#125;,&#123;\"partnerid\":983,\"count\":\"10000\",\"cityid\":\"11\"&#125;,&#123;\"partnerid\":984,\"count\":\"10000\",\"cityid\":\"11\"&#125;]&#125;  </span><br><span class="line">        //上面是正常的数据  </span><br><span class="line">        List&lt;Long&gt; list = new ArrayList&lt;Long&gt;(2);  </span><br><span class="line">        <span class="keyword">if</span>(data == null || data.length() &lt;= 0)&#123;  </span><br><span class="line">            <span class="built_in">return</span> list;  </span><br><span class="line">        &#125;      </span><br><span class="line">        int datapos = data.indexOf(<span class="string">"data"</span>);  </span><br><span class="line">        <span class="keyword">if</span>(datapos &lt; 0)&#123;  </span><br><span class="line">            <span class="built_in">return</span> list;  </span><br><span class="line">        &#125;  </span><br><span class="line">        int leftBracket = data.indexOf(<span class="string">"["</span>,datapos);  </span><br><span class="line">        int rightBracket= data.indexOf(<span class="string">"]"</span>,datapos);  </span><br><span class="line">        <span class="keyword">if</span>(leftBracket &lt; 0 || rightBracket &lt; 0)&#123;  </span><br><span class="line">            <span class="built_in">return</span> list;  </span><br><span class="line">        &#125;  </span><br><span class="line">        String partners = data.substring(leftBracket+1,rightBracket);  </span><br><span class="line">        <span class="keyword">if</span>(partners == null || partners.length() &lt;= 0)&#123;  </span><br><span class="line">            <span class="built_in">return</span> list;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">while</span>(partners!=null &amp;&amp; partners.length() &gt; 0)&#123;  </span><br><span class="line">            int idpos = partners.indexOf(<span class="string">"partnerid"</span>);  </span><br><span class="line">            <span class="keyword">if</span>(idpos &lt; 0)&#123;  </span><br><span class="line">                <span class="built_in">break</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">            int colonpos = partners.indexOf(<span class="string">":"</span>,idpos);  </span><br><span class="line">            int commapos = partners.indexOf(<span class="string">","</span>,idpos);  </span><br><span class="line">            <span class="keyword">if</span>(colonpos &lt; 0 || commapos &lt; 0)&#123;  </span><br><span class="line">                //partners = partners.substring(idpos+<span class="string">"partnerid"</span>.length());//1  </span><br><span class="line">                <span class="built_in">continue</span>;</span><br><span class="line">            &#125;  </span><br><span class="line">            String pid = partners.substring(colonpos+1,commapos);  </span><br><span class="line">            <span class="keyword">if</span>(pid == null || pid.length() &lt;= 0)&#123;  </span><br><span class="line">                //partners = partners.substring(idpos+<span class="string">"partnerid"</span>.length());//2  </span><br><span class="line">                <span class="built_in">continue</span>;</span><br><span class="line">            &#125;  </span><br><span class="line">            try&#123;  </span><br><span class="line">                list.add(Long.parseLong(pid));  </span><br><span class="line">            &#125;catch(Exception e)&#123;  </span><br><span class="line">                //<span class="keyword">do</span> nothing  </span><br><span class="line">            &#125;  </span><br><span class="line">            partners = partners.substring(commapos);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="built_in">return</span> list;  </span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问/loop端点三次，然后使用top命令：</p>
<p><img src="/images/jvm/jvm22.png" srcset="/img/loading.gif" alt="jvm"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导出线程堆栈</span></span><br><span class="line">$ jstack 7930 &gt; 7930.txt</span><br><span class="line"><span class="comment">#打印该进程下的线程</span></span><br><span class="line">$ top -p 7930 -H</span><br></pre></td></tr></table></figure>

<p><img src="/images/jvm/jvm23.png" srcset="/img/loading.gif" alt="jvm"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将十进制线程id转换为16进制</span></span><br><span class="line">$ <span class="built_in">printf</span> <span class="string">"%x"</span> 8247</span><br><span class="line">2037</span><br></pre></td></tr></table></figure>

<p>然后在导出的7930.txt文件中找到2037</p>
<p><img src="/images/jvm/jvm24.png" srcset="/img/loading.gif" alt="jvm"></p>
<p>访问/loop端点，制造死循环，使用jstack命令导出线程堆栈信息：</p>
<p><img src="/images/jvm/jvm25.png" srcset="/img/loading.gif" alt="jvm"></p>
<p>最后一行已提示：Found 1 deadlock</p>

            <hr>
          </div>
          <br>
          <div>
            <p>
            
              <span>
                <i class="iconfont icon-inbox"></i>
                
                  <a class="hover-with-bg" href="/categories/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA">JVM虚拟机</a>
                  &nbsp;
                
              </span>&nbsp;&nbsp;
            
            
              <span>
                <i class="iconfont icon-tag"></i>
                
                  <a class="hover-with-bg" href="/tags/Java">Java</a>
                
                  <a class="hover-with-bg" href="/tags/JVM">JVM</a>
                
              </span>
            
            </p>
            
              <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h5"><i class="far fa-list-alt"></i>&nbsp;目录</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
      <br><br>
      
      

    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://github.com/Loonycoder" target="_blank" rel="nofollow noopener"><b>望月</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/Loonycoder" target="_blank" rel="nofollow noopener"> <b>LoonyCoder</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv"></span>访问量: 
          <span id="busuanzi_value_site_pv"></span> &nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv"></span>访客数: 
            <span id="busuanzi_value_site_uv"></span> &nbsp;
  
  <br>



    


    <!-- cnzz Analytics icon -->
    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js" ></script>
<script src="/lib/popper/popper.min.js" ></script>
<script src="/lib/bootstrap/js/bootstrap.min.js" ></script>
<script src="/lib/mdbootstrap/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>



  <script src="/js/post.js" ></script>
  
    <script src="/lib/tocbot/tocbot.min.js" ></script>
    <script>
      $(document).ready(function () {
        tocbot.init({
          tocSelector: '#tocbot',
          contentSelector: '.post-content',
          headingSelector: 'h1,h2,h3,h4,h5,h6',
          linkClass: 'tocbot-link',
          activeLinkClass: 'tocbot-active-link',
          listClass: 'tocbot-list',
          isCollapsedClass: 'tocbot-is-collapsed',
          collapsibleClass: 'tocbot-is-collapsible',
          scrollSmooth: true,
        });
      });
    </script>
  



  <script src="/lib/smoothscroll/SmoothScroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->


  

  

  

  

  <!-- cnzz Analytics -->
  



  <script src="/lib/prettify/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "深入浅出JVM虚拟机——JVM调优&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "❡"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>





  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  








</body>
</html>
