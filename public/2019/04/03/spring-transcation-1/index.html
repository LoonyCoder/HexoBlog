<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="description" content="Life Is So Short , Just Coding.">
  <meta name="author" content="LoonyCoder">
  <meta name="keywords" content="隐约雷鸣，阴霾天空，但盼风雨来，能留你于此">
  <title>Spring事务隔离级别、传播行为以及Spring+Mybatis+Atomikos实现分布式事务管理 ~ 望月Plenilune</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"  >
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css"  >
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css"  >
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css"  >

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"  >

<link rel="stylesheet" href="/css/main.css"  >


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"  >


<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>望月Plenilune</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">分类</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">关于</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" false
         style="background: url('/images/post_banner.jpg')no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  星期三, 四月 3日 2019, 2:49 下午
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    4.2k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      18 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <h4 id="事务的定义"><a href="#事务的定义" class="headerlink" title="事务的定义"></a>事务的定义</h4><p><strong>事务是指多个操作单元组成的合集，多个单元操作是整体不可分割的，要么都操作不成功，要么都成功。其必须遵循四个原则（ACID）。</strong></p>
<blockquote>
<p><font style="color: red"><strong>原子性（Atomicity）</strong></font>：即事务是不可分割的最小工作单元，事务内的操作要么全做，要么全不做；<br><font style="color: red"><strong>一致性（Consistency）</strong></font>：在事务执行前数据库的数据处于正确的状态，而事务执行完成后数据库的数据还是应该处于正确的状态，即数据完整性约束没有被破坏；如银行转帐，A转帐给B，必须保证A的钱一定转给B，一定不会出现A的钱转了但B没收到，否则数据库的数据就处于不一致（不正确）的状态。<br><font style="color: red"><strong>隔离性（Isolation）</strong></font>：并发事务执行之间互不影响，在一个事务内部的操作对其他事务是不产生影响，这需要事务隔离级别来指定隔离性；<br><font style="color: red"><strong>持久性（Durability）</strong></font>：事务一旦执行成功，它对数据库的数据的改变必须是永久的，不会因比如遇到系统故障或断电造成数据不一致或丢失。</p>
</blockquote>
<h4 id="事务的类型"><a href="#事务的类型" class="headerlink" title="事务的类型"></a>事务的类型</h4><ol>
<li>数据库分为本地事务跟全局事务<br>本地事务：普通事务，独立一个数据库，能保证在该数据库上操作的ACID。<br>分布式事务：涉及两个或多个数据库源的事务，即跨越多台同类或异类数据库的事务（由每台数据库的本地事务组成的），分布式事务旨在保证这些本地事务的所有操作的ACID，使事务可以跨越多台数据库；</li>
<li>Java事务类型分为JDBC事务跟JTA事务<br>JDBC事务：即为上面说的数据库事务中的本地事务，通过connection对象控制管理。<br>JTA事务：JTA指Java事务API(Java Transaction API)，是Java EE数据库事务规范， JTA只提供了事务管理接口，由应用程序服务器厂商（如WebSphere Application Server）提供实现，JTA事务比JDBC更强大，支持分布式事务。</li>
<li>按是否通过编程分为声明式事务和编程式事务，参考<a href="https://loonycoder.github.io/2019/04/10/spring-transcation-2/" target="_blank" rel="noopener">Spring事务管理实现方式之编程式事务与声明式事务详解</a>;<br>声明式事务：通过XML配置或者注解实现。<br>编程式事务：通过编程代码在业务逻辑时需要时自行实现，粒度更小。</li>
</ol>
<h4 id="Spring事务隔离级别"><a href="#Spring事务隔离级别" class="headerlink" title="Spring事务隔离级别"></a>Spring事务隔离级别</h4><p><strong>Spring有五大隔离级别，其在TransactionDefinition接口中定义。看源码可知，其默isolation_default（底层数据库默认级别），其他四个隔离级别跟数据库隔离级别一致。</strong></p>
<blockquote>
<p><font style="color: red"><strong>ISOLATION_DEFAULT</strong></font>：用底层数据库的默认隔离级别，数据库管理员设置什么就是什么<br><font style="color: red"><strong>ISOLATION_READ_UNCOMMITTED（未提交读）</strong></font>：最低隔离级别、事务未提交前，就可被其他事务读取（会出现幻读、脏读、不可重复读）<br><font style="color: red"><strong>ISOLATION_READ_COMMITTED（提交读）</strong></font>：一个事务提交后才能被其他事务读取到（该隔离级别禁止其他事务读取到未提交事务的数据、所以还是会造成幻读、不可重复读）、sql server默认级别<br><font style="color: red"><strong>ISOLATION_REPEATABLE_READ（可重复读）</strong></font>：可重复读，保证多次读取同一个数据时，其值都和事务开始时候的内容是一致，禁止读取到别的事务未提交的数据（该隔离基本可防止脏读，不可重复读（重点在修改），但会出现幻读（重点在增加与删除））（MySql默认级别，更改可通过set transaction isolation level 级别）<br><font style="color: red"><strong>ISOLATION_SERIALIZABLE（序列化）</strong></font>：代价最高最可靠的隔离级别（该隔离级别能防止脏读、不可重复读、幻读）</p>
<ul>
<li>丢失更新：两个事务同时更新一行数据，最后一个事务的更新会覆盖掉第一个事务的更新，从而导致第一个事务更新的数据丢失，这是由于没有加锁造成的；</li>
<li>幻读：同样的事务操作过程中，不同时间段多次（不同事务）读取同一数据，读取到的内容不一致（一般是行数变多或变少）。</li>
<li>脏读：一个事务读取到另外一个未提及事务的内容，即为脏读。</li>
<li>不可重复读：同一事务中，多次读取内容不一致（一般行数不变，而内容变了）。</li>
</ul>
</blockquote>
<p>幻读与不可重复读的区别：幻读的重点在于<font style="color: red">插入与删除</font>，即第二次查询会发现比第一次查询数据变少或者变多了，以至于给人一种幻象一样，而不可重复读重点在于<font style="color: red">修改</font>，即第二次查询会发现查询结果比第一次查询结果不一致，即第一次结果已经不可重现了。</p>
<p>数据库隔离级别越高，执行代价越高，并发执行能力越差，因此在实际项目开发使用时要综合考虑，为了考虑<font style="color: red">并发性能</font>一般使用提交读隔离级别，它能避免丢失更新和脏读，尽管不可重复读和幻读不能避免，但可以在可能出现的场合使用<font style="color: red">悲观锁或乐观锁</font>来解决这些问题。</p>
<p>悲观锁与乐观锁可参考：<a href="https://loonycoder.github.io/2019/03/25/lock/" target="_blank" rel="noopener">乐观锁与悲观锁随笔</a></p>
<h4 id="事务的传播行为"><a href="#事务的传播行为" class="headerlink" title="事务的传播行为"></a>事务的传播行为</h4><p><strong>有七大传播行为，也是在TransactionDefinition接口中定义。</strong></p>
<blockquote>
<p><font style="color: red"><strong>PROPAGATION_REQUIRED</strong></font>：支持当前事务，如当前没有事务，则新建一个。<br><font style="color: red"><strong>PROPAGATION_SUPPORTS</strong></font>：支持当前事务，如当前没有事务，则已非事务性执行（源码中提示有个注意点，看不太明白，留待后面考究）。<br><font style="color: red"><strong>PROPAGATION_MANDATORY</strong></font>：支持当前事务，如当前没有事务，则抛出异常（强制一定要在一个已经存在的事务中执行，业务方法不可独自发起自己的事务）。<br><font style="color: red"><strong>PROPAGATION_REQUIRES_NEW</strong></font>：始终新建一个事务，如当前原来有事务，则把原事务挂起。<br><font style="color: red"><strong>PROPAGATION_NOT_SUPPORTED</strong></font>：不支持当前事务，始终已非事务性方式执行，如当前事务存在，挂起该事务。<br><font style="color: red"><strong>PROPAGATION_NEVER</strong></font>：不支持当前事务；如果当前事务存在，则引发异常。<br><font style="color: red"><strong>PROPAGATION_NESTED</strong></font>：如果当前事务存在，则在嵌套事务中执行，如果当前没有事务，则执行与 PROPAGATION_REQUIRED 类似的操作（注意：当应用到JDBC时，只适用JDBC 3.0以上驱动）。</p>
</blockquote>
<h4 id="Spring事务支持"><a href="#Spring事务支持" class="headerlink" title="Spring事务支持"></a>Spring事务支持</h4><blockquote>
<ol>
<li>Spring提供了很多内置事务管理器，支持不同数据源。常见的有三大类</li>
</ol>
</blockquote>
<ul>
<li><font style="color: red">DataSourceTransactionManager</font>：org.springframework.jdbc.datasource包下，数据源事务管理类，提供对单个javax.sql.DataSource数据源的事务管理，只要用于JDBC，Mybatis框架事务管理。</li>
<li><font style="color: red">HibernateTransactionManager</font>：org.springframework.orm.hibernate3包下，数据源事务管理类，提供对单个org.hibernate.SessionFactory事务支持，用于集成Hibernate框架时的事务管理；注意：该事务管理器只支持Hibernate3+版本，且Spring3.0+版本只支持Hibernate 3.2+版本；</li>
<li><font style="color: red">JtaTransactionManager</font>：位于org.springframework.transaction.jta包中，提供对分布式事务管理的支持，并将事务管理委托给Java EE应用服务器，或者自定义一个本地JTA事务管理器，嵌套到应用程序中。</li>
</ul>
<p>内置事务管理器都继承了抽象类AbstractPlatformTransactionManager，而AbstractPlatformTransactionManager又继承了接口PlatformTransactionManager</p>
<p>Spring框架支持事务管理的核心是事务管理器抽象，对于不同的数据访问框架通过实现策略接口PlatformTransactionManager，从而能支持多钟数据访问框架的事务管理。</p>
<p>PlatformTransactionManager接口定义如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface PlatformTransactionManager &#123;</span><br><span class="line">         TransactionStatus getTransaction(TransactionDefinition definition) throws TransactionException;//返回一个已经激活的事务或创建一个新的事务（具体由TransactionDefinition参数定义的事务属性决定），返回的TransactionStatus对象代表了当前事务的状态，其中该方法抛出TransactionException（未检查异常）表示事务由于某种原因失败。</span><br><span class="line">         void commit(TransactionStatus status) throws TransactionException;//用于提交TransactionStatus参数代表的事务。</span><br><span class="line">         void rollback(TransactionStatus status) throws TransactionException;//用于回滚TransactionStatus参数代表的事务。</span><br><span class="line">｝</span><br></pre></td></tr></table></figure>

<p>TransactionDefinition接口定义如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public interface TransactionDefinition &#123;  </span><br><span class="line">       int getPropagationBehavior();  //返回定义的事务传播行为</span><br><span class="line">       int getIsolationLevel(); //返回事务隔离级别</span><br><span class="line">       int getTimeout();  //返回定义的事务超时时间</span><br><span class="line">       boolean isReadOnly();  //返回定义的事务是否是只读的</span><br><span class="line">       String getName();  //返回事务名称</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TransactionStatus接口定义如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public interface TransactionStatus extends SavepointManager &#123;  </span><br><span class="line">       boolean isNewTransaction();  //返回当前事务是否是新的事务</span><br><span class="line">       boolean hasSavepoint();  //返回当前事务是否有保存点</span><br><span class="line">       void setRollbackOnly();  //设置事务回滚</span><br><span class="line">       boolean isRollbackOnly();  //设置当前事务是否应该回滚</span><br><span class="line">       void flush();  //用于刷新底层会话中的修改到数据库，一般用于刷新如Hibernate/JPA的会话，可能对如JDBC类型的事务无任何影响；</span><br><span class="line">       boolean isCompleted();  //返回事务是否完成</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="2">
<li>Spring分布式事务配置</li>
</ol>
</blockquote>
<ul>
<li>引用应用服务器（如Tomcat）的JNDI数据源，间接实现JTA事务管理，依赖于应用服务器</li>
<li>直接集成JOTM（官网：<a href="http://jotm.objectweb.org/" target="_blank" rel="noopener">http://jotm.objectweb.org/</a>）、Atomikos（官网：<a href="https://www.atomikos.com/" target="_blank" rel="noopener">https://www.atomikos.com/</a>）提供JTA事务管理（无应用服务器支持，常用于单元测试）</li>
<li>使用特定于应用服务器的事务管理器，使用JTA事务的高级功能（Weblogic，Websphere）</li>
</ul>
<blockquote>
<p>引用应用服务器（如Tomcat）的JNDI数据源，间接实现JTA事务管理，配置如下</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">    xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">    xmlns:jee=<span class="string">"http://www.springframework.org/schema/jee"</span></span><br><span class="line">    xsi:schemaLocation=<span class="string">"</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/jee</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/jee/spring-jee-3.0.xsd"</span>&gt;</span><br><span class="line"> &lt;!-- JNDI数据源 --&gt;</span><br><span class="line">  &lt;jee:jndi-lookup id=<span class="string">"dataSource"</span> jndi-name=<span class="string">"jdbc/test"</span>/&gt;</span><br><span class="line">    &lt;!-- JTA事务管理器  --&gt;</span><br><span class="line">  	&lt;bean id=<span class="string">"txManager"</span> class=<span class="string">"org.springframework.transaction.jta.JtaTransactionManager"</span>&gt;</span><br><span class="line">  		&lt;!--transactionManagerName指定JTA事务管理器的JNDI名字，从而将事务管理委托给该事务管理器  --&gt;</span><br><span class="line">    	&lt;property name=<span class="string">"transactionManagerName"</span> value=<span class="string">"java:comp/TransactionManager"</span>/&gt;</span><br><span class="line">  	&lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用Atomikos实现分布式事务管理，配置如下：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">	xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span><br><span class="line">	xmlns:p=<span class="string">"http://www.springframework.org/schema/p"</span></span><br><span class="line">	xmlns:aop=<span class="string">"http://www.springframework.org/schema/aop"</span>	</span><br><span class="line">	xmlns:tx=<span class="string">"http://www.springframework.org/schema/tx"</span></span><br><span class="line">	xmlns:context=<span class="string">"http://www.springframework.org/schema/context"</span></span><br><span class="line">    xmlns:task=<span class="string">"http://www.springframework.org/schema/task"</span></span><br><span class="line">	xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans </span></span><br><span class="line"><span class="string">	http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></span><br><span class="line"><span class="string">	http://www.springframework.org/schema/context </span></span><br><span class="line"><span class="string">	http://www.springframework.org/schema/context/spring-context-3.0.xsd</span></span><br><span class="line"><span class="string">	http://www.springframework.org/schema/tx</span></span><br><span class="line"><span class="string">	http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</span></span><br><span class="line"><span class="string">	http://www.springframework.org/schema/task</span></span><br><span class="line"><span class="string">	http://www.springframework.org/schema/task/spring-task-3.0.xsd</span></span><br><span class="line"><span class="string">	http://www.springframework.org/schema/aop</span></span><br><span class="line"><span class="string">	http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span></span><br><span class="line">	&gt;</span><br><span class="line">     </span><br><span class="line">	&lt;context:component-scan base-package=<span class="string">"com.loonycoder.*.service.impl"</span> /&gt;</span><br><span class="line">	&lt;context:component-scan base-package=<span class="string">"com.loonycoder.util"</span> /&gt;</span><br><span class="line">    &lt;!-- 此方法加载的配置文件仅仅在xml中使用,但是工具类都采用注解的方式 --&gt;</span><br><span class="line">	&lt;bean class=<span class="string">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;</span><br><span class="line">		&lt;property name=<span class="string">"location"</span> value=<span class="string">"classpath:conn.properties"</span> /&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;!-- 仅仅支持注解不支持在xml配置中使用properties文件  在类中可以使用SPEL表达式来加载相应的值 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"temp"</span> class=<span class="string">"org.springframework.beans.factory.config.PropertiesFactoryBean"</span>&gt;</span><br><span class="line">		&lt;property name=<span class="string">"locations"</span>&gt;</span><br><span class="line">			&lt;array&gt;</span><br><span class="line">				&lt;value&gt;classpath:public.properties&lt;/value&gt;</span><br><span class="line">			&lt;/array&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"abstractXADataSource"</span> class=<span class="string">"com.atomikos.jdbc.AtomikosDataSourceBean"</span> init-method=<span class="string">"init"</span>  destroy-method=<span class="string">"close"</span> abstract=<span class="string">"true"</span>&gt; </span><br><span class="line">        &lt;property name=<span class="string">"borrowConnectionTimeout"</span> value=<span class="string">"60"</span>/&gt;  &lt;!--获取连接失败重新获等待最大时间，在这个时间内如果有可用连接，将返回--&gt;</span><br><span class="line">        &lt;property name=<span class="string">"reapTimeout"</span> value=<span class="string">"20"</span>/&gt; &lt;!--最大获取数据时间，如果不设置这个值，Atomikos使用默认的5分钟，那么在处理大批量数据读取的时候，一旦超过5分钟，就会抛出类似 Resultset is close 的错误.--&gt;        </span><br><span class="line">        &lt;property name=<span class="string">"maintenanceInterval"</span> value=<span class="string">"60"</span> /&gt;  &lt;!--连接回收时间--&gt;    </span><br><span class="line">        &lt;property name=<span class="string">"loginTimeout"</span> value=<span class="string">"60"</span> /&gt;     &lt;!--java数据库连接池，最大可等待获取datasouce的时间--&gt;</span><br><span class="line">        &lt;property name=<span class="string">"logWriter"</span> value=<span class="string">"60"</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">"minPoolSize"</span> value=<span class="string">"1"</span> /&gt;  &lt;!-- 连接池中保留的最小连接数   --&gt;</span><br><span class="line">        &lt;property name=<span class="string">"maxPoolSize"</span> value=<span class="string">"3"</span> /&gt;  &lt;!-- 连接池中保留的最大连接数    --&gt;</span><br><span class="line">        &lt;property name=<span class="string">"maxIdleTime"</span> value=<span class="string">"60"</span> /&gt; &lt;!-- 最大空闲时间,60秒内未使用则连接被丢弃。若为0则永不丢弃。Default: 0 --&gt;</span><br><span class="line">    &lt;/bean&gt; </span><br><span class="line">     &lt;!-- 配置2个数据源 mysql --&gt;</span><br><span class="line">     &lt;bean id=<span class="string">"ds_loonycoder"</span> parent=<span class="string">"abstractXADataSource"</span>&gt;  </span><br><span class="line">     	&lt;!-- uniqueResourceName表示唯一资源名，如有多个数据源不可重复； --&gt;</span><br><span class="line">     	&lt;property name=<span class="string">"uniqueResourceName"</span> value=<span class="string">"loonycoderfortest"</span> /&gt;</span><br><span class="line">     	&lt;!--  xaDataSourceClassName是具体分布式数据源厂商实现； --&gt;</span><br><span class="line">     	&lt;property name=<span class="string">"xaDataSourceClassName"</span> value=<span class="string">"com.mysql.jdbc.jdbc2.optional.MysqlXADataSource"</span>/&gt;</span><br><span class="line">     	&lt;!-- xaProperties属性指定具体厂商数据库属性 --&gt;</span><br><span class="line">     	&lt;property name=<span class="string">"xaProperties"</span>&gt;</span><br><span class="line">            &lt;props&gt;</span><br><span class="line">                &lt;prop key=<span class="string">"URL"</span>&gt;<span class="variable">$&#123;db.jdbcUrlOne&#125;</span>&lt;/prop&gt;</span><br><span class="line">                &lt;prop key=<span class="string">"user"</span>&gt;<span class="variable">$&#123;user&#125;</span>&lt;/prop&gt;</span><br><span class="line">                &lt;prop key=<span class="string">"password"</span>&gt;<span class="variable">$&#123;password&#125;</span>&lt;/prop&gt;</span><br><span class="line">            &lt;/props&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;  </span><br><span class="line">	&lt;bean id=<span class="string">"ds_loony"</span>  parent=<span class="string">"abstractXADataSource"</span>&gt;  </span><br><span class="line">		&lt;!-- uniqueResourceName表示唯一资源名，如有多个数据源不可重复； --&gt;</span><br><span class="line">		&lt;property name=<span class="string">"uniqueResourceName"</span> value=<span class="string">"puildingpurchasefortest"</span> /&gt;</span><br><span class="line">		&lt;!-- xaDataSourceClassName是具体分布式数据源厂商实现； --&gt;</span><br><span class="line">		&lt;property name=<span class="string">"xaDataSourceClassName"</span> value=<span class="string">"com.mysql.jdbc.jdbc2.optional.MysqlXADataSource"</span>/&gt;</span><br><span class="line">		&lt;!-- xaProperties属性指定具体厂商数据库属性 --&gt;</span><br><span class="line">		&lt;property name=<span class="string">"xaProperties"</span>&gt;</span><br><span class="line">            &lt;props&gt;</span><br><span class="line">                &lt;prop key=<span class="string">"URL"</span>&gt;<span class="variable">$&#123;db.jdbcUrlTwo&#125;</span>&lt;/prop&gt;</span><br><span class="line">                &lt;prop key=<span class="string">"user"</span>&gt;<span class="variable">$&#123;user&#125;</span>&lt;/prop&gt;</span><br><span class="line">                &lt;prop key=<span class="string">"password"</span>&gt;<span class="variable">$&#123;password&#125;</span>&lt;/prop&gt;</span><br><span class="line">            &lt;/props&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;  </span><br><span class="line">    &lt;!-- 动态配置数据源 --&gt; </span><br><span class="line">    &lt;bean id=<span class="string">"dataSource2"</span> class=<span class="string">"com.loonycoder.common.datasource.DynamicDataSource"</span>&gt;  </span><br><span class="line">        &lt;property name=<span class="string">"targetDataSources"</span>&gt;  </span><br><span class="line">            &lt;map key-type =<span class="string">"java.lang.String"</span>&gt;  </span><br><span class="line">                &lt;entry value-ref =<span class="string">"ds_loonycoder"</span> key=<span class="string">"ds_loonycoder"</span>&gt;&lt;/entry &gt;  </span><br><span class="line">                &lt;entry value-ref =<span class="string">"ds_loony"</span> key=<span class="string">"ds_loony"</span>&gt;&lt;/entry &gt;  </span><br><span class="line">            &lt;/map &gt; </span><br><span class="line">        &lt;/property&gt;  </span><br><span class="line">        &lt;property name =<span class="string">"defaultTargetDataSource"</span> ref=<span class="string">"ds_loonycoder"</span>&gt;&lt;/property&gt;  </span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line">    &lt;bean id =<span class="string">"sqlSessionFactoryBeanA"</span> class=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span> &gt;  </span><br><span class="line">       &lt;!-- 指定数据源 --&gt;  </span><br><span class="line">       &lt;property name =<span class="string">"dataSource"</span> ref=<span class="string">"ds_loonycoder"</span> /&gt;  </span><br><span class="line">       &lt;!-- 指定mybatis 的配置文件 --&gt;  </span><br><span class="line">       &lt;property name =<span class="string">"configLocation"</span> value=<span class="string">"classpath:mybatis.cfg.xml"</span> /&gt;  </span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;bean id =<span class="string">"sqlSessionFactoryBeanB"</span> class=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span> &gt;  </span><br><span class="line">       &lt;!-- 指定数据源 --&gt;  </span><br><span class="line">       &lt;property name =<span class="string">"dataSource"</span> ref=<span class="string">"ds_loony"</span> /&gt;  </span><br><span class="line">       &lt;!-- 指定mybatis 的配置文件 --&gt;  </span><br><span class="line">       &lt;property name =<span class="string">"configLocation"</span> value=<span class="string">"classpath:mybatis.cfg.xml"</span> /&gt;  </span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;!--CustomSqlSessionTemplate继承SqlSessionTemplate重写getSqlSessionFactory方法，具体请下载查看--&gt; </span><br><span class="line">	&lt;bean id=<span class="string">"sqlSessionTemplate"</span> class=<span class="string">"com.loonycoder.util.CustomSqlSessionTemplate"</span> scope=<span class="string">"prototype"</span>&gt;</span><br><span class="line">        &lt;constructor-arg ref=<span class="string">"sqlSessionFactoryBeanA"</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">"targetSqlSessionFactorys"</span>&gt;</span><br><span class="line">            &lt;map&gt;     </span><br><span class="line">                &lt;entry value-ref =<span class="string">"sqlSessionFactoryBeanA"</span> key=<span class="string">"ds_loonycoder1"</span>&gt;&lt;/entry &gt;  </span><br><span class="line">                &lt;entry value-ref =<span class="string">"sqlSessionFactoryBeanB"</span> key=<span class="string">"ds_loony1"</span>&gt;&lt;/entry &gt;  </span><br><span class="line">            &lt;/map&gt; </span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;  </span><br><span class="line">    </span><br><span class="line">	&lt;!-- 配置atomikos事务管理器 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"atomikosTransactionManager"</span> class = <span class="string">"com.atomikos.icatch.jta.UserTransactionManager"</span> init-method=<span class="string">"init"</span> destroy-method = <span class="string">"close"</span>&gt;    </span><br><span class="line">	      &lt;property name=<span class="string">"forceShutdown"</span> value=<span class="string">"true"</span>/&gt;    </span><br><span class="line">	&lt;/bean&gt;    </span><br><span class="line">	&lt;bean id=<span class="string">"atomikosUserTransaction"</span> class=<span class="string">"com.atomikos.icatch.jta.UserTransactionImp"</span>&gt;&lt;/bean&gt;</span><br><span class="line">	&lt;!-- 配置spring事务管理器 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"transactionManager"</span> class=<span class="string">"org.springframework.transaction.jta.JtaTransactionManager"</span>&gt;    </span><br><span class="line">	    &lt;property name=<span class="string">"transactionManager"</span>&gt;    </span><br><span class="line">	        &lt;ref bean=<span class="string">"atomikosTransactionManager"</span>/&gt;    </span><br><span class="line">	    &lt;/property&gt;    </span><br><span class="line">	    &lt;property name=<span class="string">"userTransaction"</span>&gt;    </span><br><span class="line">	        &lt;ref bean=<span class="string">"atomikosUserTransaction"</span>/&gt;    </span><br><span class="line">	    &lt;/property&gt; </span><br><span class="line">	    &lt;!-- 必须设置，否则程序出现异常 JtaTransactionManager does not support custom isolation levels by default --&gt;</span><br><span class="line">	    &lt;property name=<span class="string">"allowCustomIsolationLevels"</span> value=<span class="string">"true"</span>/&gt;    </span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;tx:advice id=<span class="string">"advice"</span> transaction-manager=<span class="string">"transactionManager"</span>&gt;</span><br><span class="line">		&lt;tx:attributes&gt;</span><br><span class="line">		    &lt;!-- REQUIRED：必须要有事务, 如果没有就在上下文创建一个 --&gt;</span><br><span class="line">			&lt;tx:method name=<span class="string">"save*"</span> propagation=<span class="string">"REQUIRED"</span>/&gt;</span><br><span class="line">			&lt;tx:method name=<span class="string">"creat*"</span> propagation=<span class="string">"REQUIRED"</span>/&gt;</span><br><span class="line">			&lt;tx:method name=<span class="string">"add*"</span> propagation=<span class="string">"REQUIRED"</span>/&gt;</span><br><span class="line">			&lt;tx:method name=<span class="string">"update*"</span> propagation=<span class="string">"REQUIRED"</span>/&gt;</span><br><span class="line">			&lt;tx:method name=<span class="string">"delete*"</span> propagation=<span class="string">"REQUIRED"</span>/&gt;</span><br><span class="line">			&lt;!-- 支持,如果有就有,没有就没有 --&gt;</span><br><span class="line">			&lt;tx:method name=<span class="string">"*"</span> propagation=<span class="string">"SUPPORTS"</span>/&gt;</span><br><span class="line">		&lt;/tx:attributes&gt;</span><br><span class="line">	&lt;/tx:advice&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;aop:config&gt;</span><br><span class="line">	    &lt;aop:pointcut expression=<span class="string">"execution(* com.loonycoder.*.service.impl.*.*(..))"</span> id=<span class="string">"pointcut"</span>/&gt;</span><br><span class="line">	    &lt;!-- 吧 tx与aop的配置关联,才是完整的声明事务配置 --&gt;</span><br><span class="line">	    &lt;aop:advisor advice-ref=<span class="string">"advice"</span> pointcut-ref=<span class="string">"pointcut"</span>/&gt;</span><br><span class="line">	&lt;/aop:config&gt;</span><br><span class="line">	&lt;!-- 采用包扫描机制,自动会把指定的包里面的所有dao注册 --&gt;</span><br><span class="line">	&lt;bean class=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span><br><span class="line">		&lt;!-- 注意注入sqlSessionTemplate --&gt;</span><br><span class="line">        &lt;property name=<span class="string">"sqlSessionTemplateBeanName"</span> value=<span class="string">"sqlSessionTemplate"</span>/&gt;</span><br><span class="line">		&lt;property name=<span class="string">"basePackage"</span> value=<span class="string">"com.loonycoder.*.dao"</span> /&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"viewResolver"</span> class=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span><br><span class="line">		&lt;property name=<span class="string">"viewClass"</span>&gt;</span><br><span class="line">			&lt;value&gt;org.springframework.web.servlet.view.InternalResourceView&lt;/value&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">		&lt;!--jsp存放的目录--&gt;</span><br><span class="line">		&lt;property name=<span class="string">"prefix"</span>&gt;</span><br><span class="line">			&lt;value&gt;/&lt;/value&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">		&lt;!--jsp文件的后缀--&gt;</span><br><span class="line">		&lt;property name=<span class="string">"suffix"</span>&gt;</span><br><span class="line">			&lt;value&gt;.jsp&lt;/value&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;!-- 验证码 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"captchaProducer"</span> class=<span class="string">"com.google.code.kaptcha.impl.DefaultKaptcha"</span>&gt;  </span><br><span class="line">        &lt;property name=<span class="string">"config"</span>&gt;  </span><br><span class="line">            &lt;bean class=<span class="string">"com.google.code.kaptcha.util.Config"</span>&gt;  </span><br><span class="line">                &lt;constructor-arg&gt;  </span><br><span class="line">                    &lt;props&gt;  </span><br><span class="line">                        &lt;prop key=<span class="string">"kaptcha.border"</span>&gt;no&lt;/prop&gt;  </span><br><span class="line">                        &lt;prop key=<span class="string">"kaptcha.border.color"</span>&gt;105,179,90&lt;/prop&gt;  </span><br><span class="line">                        &lt;prop key=<span class="string">"kaptcha.textproducer.font.color"</span>&gt;red&lt;/prop&gt;  </span><br><span class="line">                        &lt;prop key=<span class="string">"kaptcha.image.width"</span>&gt;200&lt;/prop&gt;  </span><br><span class="line">                        &lt;prop key=<span class="string">"kaptcha.textproducer.font.size"</span>&gt;60&lt;/prop&gt;  </span><br><span class="line">                        &lt;prop key=<span class="string">"kaptcha.image.height"</span>&gt;80&lt;/prop&gt;  </span><br><span class="line">                        &lt;prop key=<span class="string">"kaptcha.session.key"</span>&gt;code&lt;/prop&gt;  </span><br><span class="line">                        &lt;prop key=<span class="string">"kaptcha.textproducer.char.length"</span>&gt;4&lt;/prop&gt;  </span><br><span class="line">                        &lt;prop key=<span class="string">"kaptcha.textproducer.font.names"</span>&gt;宋体,楷体,微软雅黑&lt;/prop&gt;  </span><br><span class="line">                    &lt;/props&gt;  </span><br><span class="line">                &lt;/constructor-arg&gt;  </span><br><span class="line">            &lt;/bean&gt;  </span><br><span class="line">        &lt;/property&gt;  </span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;bean id=<span class="string">"messageSource"</span> class=<span class="string">"org.springframework.context.support.ReloadableResourceBundleMessageSource"</span>&gt;  </span><br><span class="line">        &lt;property name=<span class="string">"basename"</span> value=<span class="string">"classpath:messages"</span>/&gt;  </span><br><span class="line">        &lt;property name=<span class="string">"fileEncodings"</span> value=<span class="string">"utf-8"</span>/&gt;  </span><br><span class="line">        &lt;property name=<span class="string">"cacheSeconds"</span> value=<span class="string">"120"</span>/&gt;  </span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>


            <hr>
          </div>
          <br>
          <div>
            <p>
            
              <span>
                <i class="iconfont icon-inbox"></i>
                
                  <a class="hover-with-bg" href="/categories/Spring">Spring</a>
                  &nbsp;
                
              </span>&nbsp;&nbsp;
            
            
              <span>
                <i class="iconfont icon-tag"></i>
                
                  <a class="hover-with-bg" href="/tags/%E4%BA%8B%E5%8A%A1">事务</a>
                
                  <a class="hover-with-bg" href="/tags/Spring">Spring</a>
                
              </span>
            
            </p>
            
              <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h5"><i class="far fa-list-alt"></i>&nbsp;目录</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
      <br><br>
      
      

    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://github.com/Loonycoder" target="_blank" rel="nofollow noopener"><b>望月</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/Loonycoder" target="_blank" rel="nofollow noopener"> <b>LoonyCoder</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv"></span>访问量: 
          <span id="busuanzi_value_site_pv"></span> &nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv"></span>访客数: 
            <span id="busuanzi_value_site_uv"></span> &nbsp;
  
  <br>



    
  <!-- 备案信息 -->
  <a href="http://beian.miit.gov.cn/" target="_blank"
     rel="nofollow noopener">京ICP证20008174号</a>
  
    <a
      href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=20008174"
      rel="nofollow noopener"
      class="police-beian"
      target="_blank"
    >
      <span class="police-beian-sep">&nbsp;|&nbsp;</span>
      
        <img src="/img/police_beian.png" />
      
      <span>京公网安备20008174号</span>
    </a>
  



    <!-- cnzz Analytics icon -->
    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js" ></script>
<script src="/lib/popper/popper.min.js" ></script>
<script src="/lib/bootstrap/js/bootstrap.min.js" ></script>
<script src="/lib/mdbootstrap/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>



  <script src="/js/post.js" ></script>
  
    <script src="/lib/tocbot/tocbot.min.js" ></script>
    <script>
      $(document).ready(function () {
        tocbot.init({
          tocSelector: '#tocbot',
          contentSelector: '.post-content',
          headingSelector: 'h1,h2,h3,h4,h5,h6',
          linkClass: 'tocbot-link',
          activeLinkClass: 'tocbot-active-link',
          listClass: 'tocbot-list',
          isCollapsedClass: 'tocbot-is-collapsed',
          collapsibleClass: 'tocbot-is-collapsible',
          scrollSmooth: true,
        });
      });
    </script>
  



  <script src="/lib/smoothscroll/SmoothScroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->


  

  

  

  

  <!-- cnzz Analytics -->
  



  <script src="/lib/prettify/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "Spring事务隔离级别、传播行为以及Spring+Mybatis+Atomikos实现分布式事务管理&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "❡"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>





  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  








</body>
</html>
